{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/Cybarry Solutions/2025 Q3/projects/testme/lib/auth.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-very-strong-secret-here-change-in-prod';\nconst encodedKey = new TextEncoder().encode(JWT_SECRET);\n\nexport interface TokenPayload {\n  userId: string;\n  role: 'admin' | 'teacher' | 'student';\n  iat?: number;\n  exp?: number;\n}\n\nexport async function generateToken(payload: TokenPayload) {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: 'HS256' })\n    .setIssuedAt()\n    .setExpirationTime('24h')\n    .sign(encodedKey);\n}\n\nexport async function verifyToken(token: string): Promise<TokenPayload | null> {\n  try {\n    const { payload } = await jwtVerify(token, encodedKey, {\n      algorithms: ['HS256'],\n    });\n    return payload as TokenPayload;\n  } catch (error) {\n    console.error('Token verification failed:', error);\n    return null;\n  }\n}\n\nexport async function getTokenFromCookies() {\n  try {\n    const cookieStore = await cookies();\n    return cookieStore.get('auth_token')?.value;\n  } catch {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth_token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    path: '/',\n    maxAge: 24 * 60 * 60, // 24 hours\n  });\n}\n\nexport async function getCurrentUser() {\n  const token = await getTokenFromCookies();\n  if (!token) return null;\n  return await verifyToken(token);\n}\n\nexport async function removeAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth_token');\n}"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC;AASrC,eAAe,cAAc,OAAqB;IACvD,OAAO,MAAM,IAAI,8RAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,OAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,kSAAS,EAAC,OAAO,YAAY;YACrD,YAAY;gBAAC;aAAQ;QACvB;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,0XAAO;QACjC,OAAO,YAAY,GAAG,CAAC,eAAe;IACxC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,0XAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;AACF;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0XAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/Cybarry Solutions/2025 Q3/projects/testme/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verifyToken, getTokenFromCookies } from '@/lib/auth';\n\nexport async function middleware(request: NextRequest) {\n  const pathname = request.nextUrl.pathname;\n  \n  // Public routes that don't need authentication\n  const publicRoutes = ['/login', '/register'];\n  const isPublicRoute = publicRoutes.includes(pathname);\n  \n  // Get token from cookies\n  const token = request.cookies.get('auth_token')?.value;\n  \n  // If no token and not public route, redirect to login\n  if (!token && !isPublicRoute) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n  \n  // If token exists, verify it\n\n  if (token) {\n    const decoded = await verifyToken(token);\n    \n    if (!decoded) {\n      // Token invalid, redirect to login\n      const response = NextResponse.redirect(new URL('/login', request.url));\n      response.cookies.delete('auth_token');\n      return response;\n    }\n    \n    // Check role-based routing\n    if (pathname.startsWith('/admin') && decoded.role !== 'admin') {\n      return NextResponse.redirect(new URL('/unauthorized', request.url));\n    }\n    \n    if (pathname.startsWith('/teacher') && decoded.role !== 'teacher' && decoded.role !== 'admin') {\n      return NextResponse.redirect(new URL('/unauthorized', request.url));\n    }\n    \n    if (pathname.startsWith('/student') && decoded.role !== 'student' && decoded.role !== 'admin' && decoded.role !== 'teacher') {\n      return NextResponse.redirect(new URL('/unauthorized', request.url));\n    }\n  }\n  \n  // Allow public routes to be accessed\n  if (isPublicRoute && token) {\n    const decoded = await verifyToken(token);\n    if (decoded) {\n      // Redirect authenticated users away from login/register\n      return NextResponse.redirect(new URL(`/${decoded.role}/dashboard`, request.url));\n    }\n  }\n  \n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)']\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IAEzC,+CAA+C;IAC/C,MAAM,eAAe;QAAC;QAAU;KAAY;IAC5C,MAAM,gBAAgB,aAAa,QAAQ,CAAC;IAE5C,yBAAyB;IACzB,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IAEjD,sDAAsD;IACtD,IAAI,CAAC,SAAS,CAAC,eAAe;QAC5B,OAAO,oYAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,6BAA6B;IAE7B,IAAI,OAAO;QACT,MAAM,UAAU,MAAM,IAAA,uMAAW,EAAC;QAElC,IAAI,CAAC,SAAS;YACZ,mCAAmC;YACnC,MAAM,WAAW,oYAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YACpE,SAAS,OAAO,CAAC,MAAM,CAAC;YACxB,OAAO;QACT;QAEA,2BAA2B;QAC3B,IAAI,SAAS,UAAU,CAAC,aAAa,QAAQ,IAAI,KAAK,SAAS;YAC7D,OAAO,oYAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE;QAEA,IAAI,SAAS,UAAU,CAAC,eAAe,QAAQ,IAAI,KAAK,aAAa,QAAQ,IAAI,KAAK,SAAS;YAC7F,OAAO,oYAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE;QAEA,IAAI,SAAS,UAAU,CAAC,eAAe,QAAQ,IAAI,KAAK,aAAa,QAAQ,IAAI,KAAK,WAAW,QAAQ,IAAI,KAAK,WAAW;YAC3H,OAAO,oYAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE;IACF;IAEA,qCAAqC;IACrC,IAAI,iBAAiB,OAAO;QAC1B,MAAM,UAAU,MAAM,IAAA,uMAAW,EAAC;QAClC,IAAI,SAAS;YACX,wDAAwD;YACxD,OAAO,oYAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,QAAQ,IAAI,CAAC,UAAU,CAAC,EAAE,QAAQ,GAAG;QAChF;IACF;IAEA,OAAO,oYAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAoD;AAChE"}}]
}